<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1080, height=1350">
    <title>Arquitectura de Ingesta Resiliente - Kafka Connect + MongoDB</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            width: 1080px;
            height: 1350px;
            background: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Segoe UI Emoji", Roboto, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }
        
        /* Título */
        .title {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease-out;
        }
        
        .title h1 {
            font-size: 56px;
            font-weight: 900;
            color: #001E2B;
            text-shadow: 3px 3px 6px rgba(255,255,255,0.9),
                        -1px -1px 2px rgba(255,255,255,0.5);
            margin-bottom: 10px;
        }
        
        .title p {
            font-size: 24px;
            color: #0D2A3D;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
        }
        
        /* SVG Container */
        .diagram-svg {
            width: 100%;
            max-width: 1000px;
            height: 900px;
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.1));
        }
        
        /* Animaciones */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.05);
            }
        }
        
        @keyframes flowDash {
            to {
                stroke-dashoffset: -40;
            }
        }
        
        @keyframes glow {
            0%, 100% {
                filter: drop-shadow(0 0 10px currentColor);
            }
            50% {
                filter: drop-shadow(0 0 20px currentColor) drop-shadow(0 0 30px currentColor);
            }
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        @keyframes dataFlow {
            0% {
                offset-distance: 0%;
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                offset-distance: 100%;
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Título -->
        <div class="title">
            <h1>Arquitectura de Ingesta Resiliente</h1>
            <p>Kafka Connect + DLQ + Schema Validator</p>
        </div>
        
        <!-- Diagrama SVG -->
        <svg class="diagram-svg" viewBox="0 0 1000 900" xmlns="http://www.w3.org/2000/svg">
            <!-- Definiciones -->
            <defs>
                <!-- Gradientes -->
                <linearGradient id="kafkaGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#2563EB;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#1E40AF;stop-opacity:1" />
                </linearGradient>
                
                <linearGradient id="connectGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#6D28D9;stop-opacity:1" />
                </linearGradient>
                
                <linearGradient id="mongoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#00ED64;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#00A847;stop-opacity:1" />
                </linearGradient>
                
                <linearGradient id="dlqGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#EF4444;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#DC2626;stop-opacity:1" />
                </linearGradient>
                
                <linearGradient id="validatorGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#D97706;stop-opacity:1" />
                </linearGradient>
                
                <!-- Filtro de sombra -->
                <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="4"/>
                    <feOffset dx="0" dy="6" result="offsetblur"/>
                    <feComponentTransfer>
                        <feFuncA type="linear" slope="0.25"/>
                    </feComponentTransfer>
                    <feMerge> 
                        <feMergeNode/>
                        <feMergeNode in="SourceGraphic"/> 
                    </feMerge>
                </filter>
                
                <!-- Marcadores de flecha -->
                <marker id="arrowBlue" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto">
                    <polygon points="0 0, 12 6, 0 12" fill="#2563EB" />
                </marker>
                
                <marker id="arrowGreen" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto">
                    <polygon points="0 0, 12 6, 0 12" fill="#00ED64" />
                </marker>
                
                <marker id="arrowRed" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto">
                    <polygon points="0 0, 12 6, 0 12" fill="#EF4444" />
                </marker>
                
                <marker id="arrowPurple" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto">
                    <polygon points="0 0, 12 6, 0 12" fill="#8B5CF6" />
                </marker>
            </defs>
            
            <!-- PASO 1: Kafka Topics -->
            <g id="kafka-topics" transform="translate(50, 350)" style="animation: scaleIn 0.6s ease-out">
                <rect x="0" y="0" width="180" height="120" rx="15" 
                      fill="white" 
                      stroke="url(#kafkaGradient)" 
                      stroke-width="3"
                      filter="url(#shadow)"/>
                
                <!-- Icono moderno de streaming -->
                <g transform="translate(90, 25)">
                    <circle cx="0" cy="0" r="20" fill="#EFF6FF" stroke="#2563EB" stroke-width="2"/>
                    <path d="M -10 0 L 10 0 M -10 -7 L 10 -7 M -10 7 L 10 7" 
                          stroke="#2563EB" stroke-width="2" stroke-linecap="round"
                          style="animation: pulse 2s infinite"/>
                </g>
                
                <text x="90" y="65" font-size="20" font-weight="bold" text-anchor="middle" fill="#001E2B">
                    Kafka Topics
                </text>
                <text x="90" y="85" font-size="13" text-anchor="middle" fill="#0D2A3D">
                    Fuente de Datos
                </text>
                <text x="90" y="102" font-size="11" text-anchor="middle" fill="#718096">
                    Transacciones entrantes
                </text>
            </g>
            
            <!-- PASO 2: Kafka Connect Framework -->
            <g id="kafka-connect" transform="translate(280, 300)" style="animation: scaleIn 0.8s ease-out 0.2s backwards">
                <rect x="0" y="0" width="220" height="220" rx="20" 
                      fill="white" 
                      stroke="url(#connectGradient)" 
                      stroke-width="4"
                      filter="url(#shadow)"/>
                
                <!-- Icono de engranajes conectados -->
                <g transform="translate(110, 35)">
                    <g style="animation: rotate 8s linear infinite">
                        <circle cx="0" cy="0" r="18" fill="none" stroke="#8B5CF6" stroke-width="3"/>
                        <circle cx="0" cy="0" r="8" fill="#8B5CF6"/>
                        <rect x="-4" y="-20" width="8" height="6" fill="#8B5CF6"/>
                        <rect x="-4" y="14" width="8" height="6" fill="#8B5CF6"/>
                        <rect x="-20" y="-4" width="6" height="8" fill="#8B5CF6"/>
                        <rect x="14" y="-4" width="6" height="8" fill="#8B5CF6"/>
                    </g>
                </g>
                
                <text x="110" y="75" font-size="20" font-weight="bold" text-anchor="middle" fill="#001E2B">
                    Kafka Connect
                </text>
                <text x="110" y="95" font-size="13" font-weight="600" text-anchor="middle" fill="#8B5CF6">
                    MongoDB Sink Connector
                </text>
                
                <!-- SMTs -->
                <g transform="translate(15, 110)">
                    <rect x="0" y="0" width="190" height="30" rx="5" fill="#F3F1FF" stroke="#8B5CF6" stroke-width="1"/>
                    <text x="10" y="20" font-size="12" font-weight="600" fill="#6D28D9">⚙️ SMTs</text>
                    <text x="60" y="20" font-size="11" fill="#0D2A3D">Transformaciones</text>
                </g>
                
                <!-- Error Detection -->
                <g transform="translate(15, 145)">
                    <rect x="0" y="0" width="190" height="30" rx="5" fill="#FEF2F2" stroke="#EF4444" stroke-width="1"/>
                    <text x="10" y="20" font-size="12" font-weight="600" fill="#DC2626">🔍 Detección</text>
                    <text x="80" y="20" font-size="11" fill="#0D2A3D">JSON inválido</text>
                </g>
                
                <!-- DLQ Config -->
                <g transform="translate(15, 180)">
                    <rect x="0" y="0" width="190" height="30" rx="5" fill="#FEF2F2" stroke="#EF4444" stroke-width="1"/>
                    <text x="10" y="20" font-size="12" font-weight="600" fill="#DC2626">↪️ DLQ</text>
                    <text x="55" y="20" font-size="11" fill="#0D2A3D">Redirección automática</text>
                </g>
            </g>
            
            <!-- PASO 3: DLQ Topic -->
            <g id="dlq-topic" transform="translate(320, 580)" style="animation: scaleIn 1s ease-out 0.6s backwards">
                <rect x="0" y="0" width="180" height="100" rx="15" 
                      fill="rgba(254,242,242,0.98)" 
                      stroke="url(#dlqGradient)" 
                      stroke-width="3"
                      filter="url(#shadow)"/>
                
                <!-- Icono de advertencia -->
                <g transform="translate(90, 25)">
                    <path d="M 0 -15 L -13 10 L 13 10 Z" fill="#FEE2E2" stroke="#EF4444" stroke-width="2"/>
                    <text x="0" y="8" font-size="16" font-weight="bold" text-anchor="middle" fill="#EF4444">!</text>
                </g>
                
                <text x="90" y="55" font-size="18" font-weight="bold" text-anchor="middle" fill="#991B1B">
                    DLQ Topic
                </text>
                <text x="90" y="73" font-size="12" text-anchor="middle" fill="#0D2A3D">
                    transacciones.dlq
                </text>
                <text x="90" y="88" font-size="11" text-anchor="middle" fill="#718096">
                    Mensajes rechazados
                </text>
            </g>
            
            <!-- PASO 4: MongoDB Atlas con Schema Validator -->
            <g id="mongodb-atlas" transform="translate(600, 280)" style="animation: scaleIn 1s ease-out 0.4s backwards">
                <rect x="0" y="0" width="380" height="260" rx="20" 
                      fill="white" 
                      stroke="url(#mongoGradient)" 
                      stroke-width="4"
                      filter="url(#shadow)"/>
                
                <!-- Icono de base de datos con escudo -->
                <g transform="translate(190, 35)">
                    <ellipse cx="0" cy="-5" rx="22" ry="8" fill="#D1FAE5" stroke="#00ED64" stroke-width="2"/>
                    <rect x="-22" y="-5" width="44" height="20" fill="#D1FAE5"/>
                    <ellipse cx="0" cy="15" rx="22" ry="8" fill="#D1FAE5" stroke="#00ED64" stroke-width="2"/>
                    <path d="M -22 -5 L -22 15 M 22 -5 L 22 15" stroke="#00ED64" stroke-width="2"/>
                </g>
                
                <text x="190" y="75" font-size="22" font-weight="bold" text-anchor="middle" fill="#001E2B">
                    MongoDB Atlas
                </text>
                <text x="190" y="95" font-size="14" font-weight="600" text-anchor="middle" fill="#00684B">
                    Destino Final + Gobernanza
                </text>
                
                <!-- Schema Validator Box -->
                <g transform="translate(20, 110)">
                    <rect x="0" y="0" width="340" height="130" rx="10" fill="#FEF9E7" stroke="url(#validatorGradient)" stroke-width="2"/>
                    
                    <g transform="translate(170, 20)">
                        <path d="M 0 -10 L -10 0 L -10 8 L 0 14 L 10 8 L 10 0 Z" 
                              fill="#FEF3C7" stroke="#F59E0B" stroke-width="2"/>
                        <text x="0" y="5" font-size="12" font-weight="bold" text-anchor="middle" fill="#92400E">✓</text>
                    </g>
                    
                    <text x="170" y="45" font-size="16" font-weight="bold" text-anchor="middle" fill="#92400E">
                        Schema Validator
                    </text>
                    
                    <text x="20" y="70" font-size="11" fill="#0D2A3D">• required: ["transaction_id", "amount"]</text>
                    <text x="20" y="85" font-size="11" fill="#0D2A3D">• bsonType: "double" para amount</text>
                    <text x="20" y="100" font-size="11" fill="#0D2A3D">• enum: ["USD", "ARS", "MXN"] para currency</text>
                    <text x="20" y="115" font-size="11" fill="#0D2A3D">• minimum: 0 para validación de negocio</text>
                </g>
            </g>
            
            <!-- PASO 5: Procesamiento DLQ -->
            <g id="dlq-processor" transform="translate(100, 730)" style="animation: scaleIn 1.2s ease-out 0.8s backwards">
                <rect x="0" y="0" width="200" height="100" rx="15" 
                      fill="rgba(255,255,255,0.98)" 
                      stroke="#6B7280" 
                      stroke-width="2"
                      filter="url(#shadow)"/>
                
                <!-- Icono de procesamiento -->
                <g transform="translate(100, 25)">
                    <rect x="-15" y="-10" width="30" height="20" rx="3" fill="#F3F4F6" stroke="#6B7280" stroke-width="2"/>
                    <circle cx="0" cy="0" r="3" fill="#6B7280"/>
                    <path d="M -8 0 L -5 0 M 5 0 L 8 0" stroke="#6B7280" stroke-width="2"/>
                </g>
                
                <text x="100" y="55" font-size="16" font-weight="bold" text-anchor="middle" fill="#001E2B">
                    Consumidor DLQ
                </text>
                <text x="100" y="73" font-size="12" text-anchor="middle" fill="#0D2A3D">
                    Alertas y Registro
                </text>
                <text x="100" y="88" font-size="11" text-anchor="middle" fill="#718096">
                    Gestión de errores
                </text>
            </g>
            
            <!-- Colección de destino -->
            <g id="collection" transform="translate(750, 580)" style="animation: scaleIn 1s ease-out 0.7s backwards">
                <rect x="0" y="0" width="180" height="100" rx="15" 
                      fill="rgba(209,250,229,0.98)" 
                      stroke="#00ED64" 
                      stroke-width="3"
                      filter="url(#shadow)"/>
                
                <!-- Icono de colección -->
                <g transform="translate(90, 25)">
                    <rect x="-18" y="-12" width="36" height="24" rx="3" fill="white" stroke="#00ED64" stroke-width="2"/>
                    <path d="M -10 -5 L 10 -5 M -10 0 L 10 0 M -10 5 L 10 5" stroke="#00ED64" stroke-width="1.5"/>
                </g>
                
                <text x="90" y="55" font-size="18" font-weight="bold" text-anchor="middle" fill="#00684B">
                    transactions
                </text>
                <text x="90" y="73" font-size="12" text-anchor="middle" fill="#0D2A3D">
                    Colección validada
                </text>
                <text x="90" y="88" font-size="11" text-anchor="middle" fill="#047857">
                    Datos de calidad
                </text>
            </g>
            
            <!-- Flujos y conexiones -->
            
            <!-- Kafka Topics -> Kafka Connect -->
            <path d="M 230 410 L 280 410" 
                  stroke="#2563EB" 
                  stroke-width="3" 
                  stroke-dasharray="8,4"
                  fill="none"
                  marker-end="url(#arrowBlue)"
                  style="animation: flowDash 2s linear infinite"/>
            
            <!-- Kafka Connect -> MongoDB (flujo válido) -->
            <path d="M 500 410 L 600 410" 
                  stroke="#00ED64" 
                  stroke-width="3" 
                  stroke-dasharray="8,4"
                  fill="none"
                  marker-end="url(#arrowGreen)"
                  style="animation: flowDash 2s linear infinite"/>
            
            <!-- Kafka Connect -> DLQ (flujo de error) -->
            <path d="M 390 520 L 410 580" 
                  stroke="#EF4444" 
                  stroke-width="3" 
                  stroke-dasharray="8,4"
                  fill="none"
                  marker-end="url(#arrowRed)"
                  style="animation: flowDash 2.5s linear infinite"/>
            
            <!-- MongoDB Schema Validator -> DLQ (rechazo) -->
            <path d="M 790 540 Q 600 630 500 630" 
                  stroke="#F59E0B" 
                  stroke-width="2" 
                  stroke-dasharray="6,3"
                  fill="none"
                  marker-end="url(#arrowRed)"
                  opacity="0.8"
                  style="animation: flowDash 3s linear infinite"/>
            
            <!-- MongoDB -> Collection (éxito) -->
            <path d="M 840 540 L 840 580" 
                  stroke="#00ED64" 
                  stroke-width="3" 
                  stroke-dasharray="8,4"
                  fill="none"
                  marker-end="url(#arrowGreen)"
                  style="animation: flowDash 2s linear infinite"/>
            
            <!-- DLQ -> DLQ Processor -->
            <path d="M 320 630 L 200 730" 
                  stroke="#6B7280" 
                  stroke-width="2" 
                  stroke-dasharray="6,3"
                  fill="none"
                  marker-end="url(#arrowBlue)"
                  opacity="0.7"
                  style="animation: flowDash 3s linear infinite"/>
            
            <!-- Partículas de datos animadas -->
            <circle r="5" fill="#2563EB" style="animation: glow 2s infinite">
                <animateMotion dur="5s" repeatCount="indefinite">
                    <mpath href="#validPath"/>
                </animateMotion>
            </circle>
            
            <circle r="5" fill="#EF4444" style="animation: glow 2s infinite">
                <animateMotion dur="6s" repeatCount="indefinite" begin="2s">
                    <mpath href="#errorPath"/>
                </animateMotion>
            </circle>
            
            <!-- Paths invisibles para las partículas -->
            <path id="validPath" d="M 230 410 L 390 410 L 790 410 L 840 580" stroke="none" fill="none"/>
            <path id="errorPath" d="M 230 410 L 390 410 L 410 630" stroke="none" fill="none"/>
            
            <!-- Labels de flujo -->
            <text x="255" y="400" font-size="11" fill="#2563EB" font-weight="600">eventos</text>
            <text x="550" y="400" font-size="11" fill="#00ED64" font-weight="600">válidos</text>
            <text x="420" y="555" font-size="11" fill="#EF4444" font-weight="600">errores</text>
            <text x="650" y="600" font-size="11" fill="#F59E0B" font-weight="600">rechazados</text>
            
            <!-- Indicadores de paso -->
            <g transform="translate(50, 50)">
                <circle cx="0" cy="0" r="20" fill="#EFF6FF" stroke="#2563EB" stroke-width="2"/>
                <text x="0" y="5" font-size="14" font-weight="bold" text-anchor="middle" fill="#2563EB">1</text>
            </g>
            
            <g transform="translate(280, 50)">
                <circle cx="0" cy="0" r="20" fill="#F3F1FF" stroke="#8B5CF6" stroke-width="2"/>
                <text x="0" y="5" font-size="14" font-weight="bold" text-anchor="middle" fill="#8B5CF6">2</text>
            </g>
            
            <g transform="translate(500, 50)">
                <circle cx="0" cy="0" r="20" fill="#FEF2F2" stroke="#EF4444" stroke-width="2"/>
                <text x="0" y="5" font-size="14" font-weight="bold" text-anchor="middle" fill="#EF4444">3</text>
            </g>
            
            <g transform="translate(720, 50)">
                <circle cx="0" cy="0" r="20" fill="#D1FAE5" stroke="#00ED64" stroke-width="2"/>
                <text x="0" y="5" font-size="14" font-weight="bold" text-anchor="middle" fill="#00ED64">4</text>
            </g>
            
            <g transform="translate(940, 50)">
                <circle cx="0" cy="0" r="20" fill="#F3F4F6" stroke="#6B7280" stroke-width="2"/>
                <text x="0" y="5" font-size="14" font-weight="bold" text-anchor="middle" fill="#6B7280">5</text>
            </g>
        </svg>
    </div>
</body>
</html>